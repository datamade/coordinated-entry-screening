{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<div class='row'>
    <div class='col-md-10 offset-md-1'>
        <div class='row mt-4'>
            <div class='col-md-12'>
                <h2>Open sessions</h2>
                <h4><span class='badge badge-pill badge-primary'>{{ open_sessions }}</span> users have open sessions</h4>
                <p>These users started a survey in the last 24 hours.</p>
            </div>
        </div>
        <div class='row mt-4'>
            <div class='col-md-12'>
                <h2>Canceled sessions</h2>
                <h4><span class='badge badge-pill badge-primary'>{{ canceled_sessions }}</span> users canceled their session</h4>
                <p>These users canceled their session, either by instructing the tool to close their session (e.g. by typing "end") or by abandoning their session after 24 hours. This chart shows the question or resource on which users canceled their sessions.</p>
                <div id="canceled-chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>
        <div class='row mt-4'>
            <div class='col-md-12'>
                <h2>Completed sessions</h2>
                <h4><span class='badge badge-pill badge-primary'>{{ completed_sessions }}</span> users completed their session</h4>
                <p>These users completed the entire survey! This chart shows the last message or resource sent to the user.</p>
                <div id="completed-chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>
        <div class='row mt-4'>
            <div class='col-md-12'>
                <h2>Recommended Resources</h2>
                <p>This chart shows the total number of times each resource has been recommended.</p>
                <div id="resources-chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_javascript %}

<script>
    $(function() {

        canceled_sessions_chart = JSON.parse('{{canceled_sessions_chart | escapejs}}');
        canceled_sessions_map = JSON.parse('{{canceled_sessions_map | escapejs}}');
        stackedBarHelper('canceled-chart', canceled_sessions_chart, canceled_sessions_map);

        completed_sessions_chart = JSON.parse('{{completed_sessions_chart | escapejs}}');
        completed_sessions_map = JSON.parse('{{completed_sessions_map | escapejs}}');
        stackedBarHelper('completed-chart', completed_sessions_chart, completed_sessions_map);

        resources_chart = JSON.parse('{{resources_chart | escapejs}}');
        resources_map = JSON.parse('{{resources_map | escapejs}}');
        console.log(resources_chart)
        barHelper('resources-chart', resources_chart, resources_map);

    });
</script>

{% endblock extra_javascript %}
